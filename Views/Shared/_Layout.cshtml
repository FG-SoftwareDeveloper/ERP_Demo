<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - ERP_Demo</title>
    <script type="importmap"></script>
    <!-- Bootstrap 5 CSS (kept for general components like navbar, but removed table-specific styles) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- DataTables CSS (Core) - No Bootstrap integration CSS for DataTables, rely on custom Tailwind styling -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/rowgroup/1.3.1/css/rowGroup.dataTables.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/ERP_Demo.styles.css" asp-append-version="true" />
</head>
<body class="dashboard-gradient">
    <div class="d-flex dashboard-container" id="wrapper">
        <!-- Sidebar -->
        <div class="sidebar-full d-flex flex-column" id="sidebar-wrapper">
            <div class="sidebar-heading text-center py-3">
            </div>
            <nav id="sidebarMenu" class="nav flex-column mt-2">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dashboardDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-speedometer me-2"></i> Dashboard
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="dashboardDropdown">
                        <li><a class="dropdown-item" asp-controller="/Dashboards/Admin">Admin Dashboard</a></li>
                        <li><a class="dropdown-item" asp-controller="/Dashboards/Finance">Finance Dashboard</a></li>
                        <li><a class="dropdown-item" asp-controller="/Dashboards/HR">HR Dashboard</a></li>
                        <li><a class="dropdown-item" asp-controller="/Dashboards/Operations">Operations Dashboard</a></li>
                        <li><a class="dropdown-item" asp-controller="/Dashboards/Projects">Projects Dashboard</a></li>
                    </ul>
                </li>
                <a asp-controller="Accounts" asp-action="ListAccounts" class="nav-link">
                    <i class="bi bi-cash-coin me-2"></i> Accounts
                </a>
                <a asp-controller="APInvoices" asp-action="ListAPInvoice" class="nav-link">
                    <i class="bi bi-file-earmark-spreadsheet me-2"></i> AP Invoices
                </a>
                <a asp-controller="ARInvoices" asp-action="ListARInvoices" class="nav-link">
                    <i class="bi bi-receipt me-2"></i> AR Invoices
                </a>
                <a asp-controller="BankAccounts" asp-action="ListBankAccounts" class="nav-link">
                    <i class="bi bi-bank me-2"></i> Bank Accounts
                </a>
                <a asp-controller="Companies" asp-action="ListCompanies" class="nav-link">
                    <i class="bi bi-building me-2"></i> Companies
                </a>
                <a asp-controller="Customers" asp-action="ListCustomers" class="nav-link">
                    <i class="bi bi-people me-2"></i> Customers
                </a>
                <a asp-controller="Departments" asp-action="ListDepartments" class="nav-link">
                    <i class="bi bi-diagram-3 me-2"></i> Departments
                </a>
                <a asp-controller="Documents" asp-action="ListDocuments" class="nav-link">
                    <i class="bi bi-folder me-2"></i> Documents
                </a>
                <a asp-controller="Employees" asp-action="ListEmployees" class="nav-link">
                    <i class="bi bi-person-badge me-2"></i> Employees
                </a>
                <a asp-controller="Equipment" asp-action="ListEquipment" class="nav-link">
                    <i class="bi bi-tools me-2"></i> Equipment
                </a>
                <a asp-controller="FinancialSnapshots" asp-action="ListFinancialSnapshot" class="nav-link">
                    <i class="bi bi-graph-up me-2"></i> Financial Snapshot
                </a>
                <a asp-controller="JournalEntries" asp-action="ListJournalEntries" class="nav-link">
                    <i class="bi bi-journal-text me-2"></i> Journal
                </a>
                <a asp-controller="MaintenanceRecords" asp-action="ListMaintenanceRecords" class="nav-link">
                    <i class="bi bi-wrench me-2"></i> Maintenance Records
                </a>
                <a asp-controller="Materials" asp-action="ListMaterials" class="nav-link">
                    <i class="bi bi-box-seam me-2"></i> Materials
                </a>
                <a asp-controller="MaterialUsage" asp-action="ListMaterialUsage" class="nav-link">
                    <i class="bi bi-truck me-2"></i> Material Usage
                </a>
                <a asp-controller="Payments" asp-action="ListPayments" class="nav-link">
                    <i class="bi bi-credit-card me-2"></i> Payments
                </a>
                <a asp-controller="PayrollRuns" asp-action="ListPayrollRuns" class="nav-link">
                    <i class="bi bi-calculator me-2"></i> Payroll Runs
                </a>
                <a asp-controller="ProjectFinancialSummary" asp-action="ListProjectFinancialSummary" class="nav-link">
                    <i class="bi bi-pie-chart me-2"></i> Project Financial Summary
                </a>
                <a asp-controller="Projects" asp-action="ListProjects" class="nav-link">
                    <i class="bi bi-kanban me-2"></i> Projects
                </a>
                <a asp-controller="PurchaseOrderLines" asp-action="ListPurchaseOrderLines" class="nav-link">
                    <i class="bi bi-list-ol me-2"></i> Purchase Order Lines
                </a>
                <a asp-controller="PurchaseOrders" asp-action="ListPurchaseOrders" class="nav-link">
                    <i class="bi bi-cart-check me-2"></i> Purchase Orders
                </a>
                <a asp-controller="Receipts" asp-action="ListReceipts" class="nav-link">
                    <i class="bi bi-clipboard-check me-2"></i> Receipts
                </a>
                <a asp-controller="RFIs" asp-action="ListRFIs" class="nav-link">
                    <i class="bi bi-question-circle me-2"></i> RFIs
                </a>
                <a asp-controller="Roles" asp-action="ListRoles" class="nav-link">
                    <i class="bi bi-person-fill-gear me-2"></i> Roles
                </a>
                <a asp-controller="ServiceAgreements" asp-action="ListServiceAgreements" class="nav-link">
                    <i class="bi bi-handshake me-2"></i> Service Agreements
                </a>
                <a asp-controller="ServiceOrders" asp-action="ListServiceOrders" class="nav-link">
                    <i class="bi bi-clipboard-data me-2"></i> Service Orders
                </a>
            </nav>
        </div>
        <!-- /#sidebar-wrapper -->
        <!-- Page Content Wrapper -->
        <div id="page-content-wrapper">
            <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">ERP BI Operations</a>
                    <div class="position-absolute top-0 end-0 mt-2 me-2">
                        <label class="theme-switch">
                            <input type="checkbox" id="themeToggle">
                            <span class="slider">
                                <i class="bi bi-sun-fill"></i>
                                <i class="bi bi-moon-fill"></i>
                            </span>
                        </label>
                    </div>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" id="combinedNavbarSidebarToggle">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" asp-controller="/Index">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Features</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Pricing</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link disabled" aria-disabled="true">Disabled</a>
                            </li>
                        </ul>
                        <ul class="navbar-nav">
                            <partial name="_LoginPartial" />
                        </ul>
                    </div>
                </div>
            </nav>

            <div class="container-fluid py-4">
                <main role="main" class="pb-3">
                    @RenderBody()
                </main>
            </div>
        </div>
    </div>
    <footer class="border-top footer text-muted">
        <div class="container">
            &copy; 2025 - ERP_Demo - <a asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>
        </div>
    </footer>
    <!-- jQuery (must be loaded before DataTables) -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <!-- Bootstrap 5 JS Bundle (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables JS (Core) -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/rowgroup/1.3.1/js/dataTables.rowGroup.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
        <script>
        $(document).ready(function() {
            // Theme Toggle Logic
            const themeToggle = $('#themeToggle');
            const htmlElement = $('html'); // Target the html element for data-theme

            // Function to set the theme
            function setTheme(theme) {
                htmlElement.attr('data-theme', theme);
                localStorage.setItem('theme', theme);
                // Update the checkbox state
                themeToggle.prop('checked', theme === 'dark');
            }

            // Load theme from localStorage on page load
            const savedTheme = localStorage.getItem('theme') || 'light'; // Default to light
            setTheme(savedTheme);

            // Listen for theme toggle changes
            themeToggle.on('change', function() {
                if ($(this).is(':checked')) {
                    setTheme('dark');
                } else {
                    setTheme('light');
                }
            });

            // Combined Toggle functionality for Navbar and Sidebar
            $("#combinedNavbarSidebarToggle").click(function(e) {
                e.preventDefault();
                $("#wrapper").toggleClass("toggled");
            });

            // Function to set active class on sidebar link
            function setActiveLink(path) {
                $('#sidebarMenu .nav-link').removeClass('active');
                $('#sidebarMenu a.nav-link').each(function() {
                    const linkUrl = $(this).data('page-url');
                    if (linkUrl && (path === linkUrl || (path.startsWith(linkUrl) && linkUrl !== "/"))) {
                        $(this).addClass('active');
                    } else if (linkUrl === "/Index" && path === "/") {
                        $(this).addClass('active');
                    }
                });
            }

            // Initial active link setting
            setActiveLink(window.location.pathname);

            // AJAX page loading logic
            async function loadPageContent(url, pushState = true) {
                try {
                    const response = await fetch(url);
                    const html = await response.text();

                    // Create a temporary div to parse the fetched HTML
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = html;

                    // Extract the content of the <main> tag
                    const newMainContent = tempDiv.querySelector('main[role="main"]');

                    if (newMainContent) {
                        // Replace the current main content
                        $('#main-content-area').html(newMainContent.innerHTML);

                        // Update the browser URL without reloading
                        if (pushState) {
                            history.pushState({ path: url }, '', url);
                        }

                        // Update active sidebar link
                        setActiveLink(url);

                        // Scroll to top of the content area, not the entire page
                        $('#main-content-area').scrollTop(0);

                        // Re-initialize DataTables and Charts for the new content
                        // This function will be defined in site.js
                        if (typeof initializeCurrentPageFeatures === 'function') {
                            initializeCurrentPageFeatures();
                        }
                    } else {
                        console.error('Could not find <main> content in fetched HTML for:', url);
                    }
                } catch (error) {
                    console.error('Error loading page content:', error);
                    // Optionally, redirect to the full page on error
                    window.location.href = url;
                }
            }

            // Handle sidebar link clicks
            $(document).on('click', '.sidebar-ajax-link', function(e) {
                e.preventDefault(); // Prevent default link behavior
                const url = $(this).data('page-url');
                if (url) {
                    loadPageContent(url);
                }
            });

            // Handle browser back/forward buttons
            window.addEventListener('popstate', (event) => {
                if (event.state && event.state.path) {
                    loadPageContent(event.state.path, false); // Don't push state again
                } else {
                    // Fallback for initial page load or if state is null
                    loadPageContent(window.location.pathname, false);
                }
            });

            // Initial load of page features (for the page loaded on first visit)
            // This will ensure DataTables and Charts on the initial page are set up.
            if (typeof initializeCurrentPageFeatures === 'function') {
                initializeCurrentPageFeatures();
            }

                    /**Home Page*/
       
            // Simple animation for KPI numbers (optional, but adds a nice touch)
            function animateValue(id, start, end, duration, prefix = '', suffix = '') {
                let current = start;
                const range = end - start;
                const increment = end > start ? 1 : -1;
                const stepTime = Math.abs(Math.floor(duration / range));
                const obj = document.getElementById(id);

                if (!obj) return; // Exit if element not found

                const timer = setInterval(() => {
                    current += increment;
                    if ((increment > 0 && current > end) || (increment < 0 && current < end)) {
                        current = end;
                    }
                    if (id === 'kpiRevenue' || id === 'kpiTotalInventoryValue') { // Assuming these are currency
                        obj.textContent = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(current);
                    } else if (id === 'kpiProfitMargin') {
                        obj.textContent = current.toFixed(1) + '%';
                    } else {
                        obj.textContent = prefix + current.toLocaleString() + suffix;
                    }

                    if (current === end) {
                        clearInterval(timer);
                    }
                }, stepTime);
            }

            // Trigger animations for KPIs on page load
            // Using dummy values for now. In a real app, these would come from your backend.
            animateValue('kpiRevenue', 0, 1234567, 2000);
            animateValue('kpiProfitMargin', 0, 28.5, 1500);
            animateValue('kpiActiveUsers', 0, 1500, 1800, '', '+');

            // Add a subtle bounce animation to the hero button after a delay
            setTimeout(() => {
                $('.animate-bounce-once').removeClass('animate-bounce-once').addClass('animate-pulse-subtle');
            }, 2500); // Remove bounce and add subtle pulse after 2.5 seconds

            // Simple intersection observer for fade-in effect on sections
            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.1
            };

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        $(entry.target).addClass('fade-in-visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);

            $('.module-card, .data-card, .dashboard-link-card').each(function () {
                observer.observe(this);
            });

        });
        
    </script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
