@{
    Layout = "_Layout";
    // Example data for static design; replace with your model in production
    var projects = new[] {
        new { ProjectID = 1, Name = "HQ Expansion", Status = "Active", Budget = 2500000m, Spent = 1800000m, Forecast = 2600000m, Profit = 400000m, LastUpdate = DateTime.Parse("2025-08-28"), AIInsights = "On track. Forecast within 5% of budget." },
        new { ProjectID = 2, Name = "Bridge Build", Status = "Delayed", Budget = 3200000m, Spent = 2900000m, Forecast = 3500000m, Profit = 200000m, LastUpdate = DateTime.Parse("2025-08-25"), AIInsights = "Delay due to material shortage. Over budget risk." },
        new { ProjectID = 3, Name = "Warehouse Retrofit", Status = "Completed", Budget = 1200000m, Spent = 1150000m, Forecast = 1200000m, Profit = 150000m, LastUpdate = DateTime.Parse("2025-08-20"), AIInsights = "Completed under budget. Profit margin above target." }
    };
}

<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card glass-effect border-0">
                <div class="card-body p-4 d-flex flex-column flex-md-row align-items-md-center justify-content-between">
                    <div><h1 class="mb-1 text-themed-primary d-flex align-items-center"><i class="bi bi-pie-chart me-3 icon-primary fs-2"></i> Project Financial Summary</h1><p class="text-themed-secondary mb-0">Earned value, forecast, sensitivity — with AI narrative.</p></div>
                    <div class="mt-3 mt-md-0 d-flex flex-wrap gap-2">
                        <button class="btn btn-themed-secondary" data-bs-toggle="modal" data-bs-target="#aiNarrative"><i class="bi bi-robot me-2"></i>AI Narrative</button>
                        <button class="btn btn-outline-secondary" data-bs-toggle="offcanvas" data-bs-target="#scenarioPanel"><i class="bi bi-sliders me-2"></i>Scenarios</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Signature: EVM cards + CPI/SPI + Tornado -->
    <div class="row g-4 mb-4">
        <div class="col-md-3"><div class="card hover-3d kpi-card border-0"><div class="card-body p-4"><div class="small text-themed-secondary">BAC</div><div class="display-6 text-themed-primary">$12.4M</div><small>Budget at completion</small></div></div></div>
        <div class="col-md-3"><div class="card hover-3d kpi-card border-0"><div class="card-body p-4"><div class="small text-themed-secondary">EAC</div><div class="display-6 text-themed-primary">$13.1M</div><small>Forecast at completion</small></div></div></div>
        <div class="col-md-3"><div class="card hover-3d kpi-card border-0"><div class="card-body p-4"><div class="small text-themed-secondary">CPI</div><div class="display-6 text-success">1.05</div><small>Cost performance</small></div></div></div>
        <div class="col-md-3"><div class="card hover-3d kpi-card border-0"><div class="card-body p-4"><div class="small text-themed-secondary">SPI</div><div class="display-6 text-warning">0.92</div><small>Schedule performance</small></div></div></div>
    </div>

    <div class="row g-4">
        <div class="col-xxl-7">
            <div class="card glass-effect border-0 h-100">
                <div class="card-header p-4 bg-transparent border-0"><h5 class="mb-0 text-themed-primary"><i class="bi bi-graph-up-arrow me-2 icon-info"></i>EV Curve (BAC / EV / AC)</h5></div>
                <div class="card-body p-4"><div class="chart-container"><canvas id="evCurve"></canvas></div></div>
            </div>
        </div>
        <div class="col-xxl-5">
            <div class="card glass-effect border-0 h-100">
                <div class="card-header p-4 bg-transparent border-0"><h5 class="mb-0 text-themed-primary"><i class="bi bi-wind me-2 icon-warning"></i>Sensitivity (Tornado)</h5></div>
                <div class="card-body p-4"><div class="chart-container"><canvas id="tornado"></canvas></div></div>
            </div>
        </div>
    </div>

    <!-- Table: project list with margin + forecast -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card themed-table border-0">
                <div class="card-header p-4 bg-transparent border-0"><h5 class="mb-0 text-themed-primary"><i class="bi bi-table me-2 icon-primary"></i>Projects</h5></div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead><tr><th>Project</th><th>Manager</th><th>BAC</th><th>EV</th><th>AC</th><th>CPI</th><th>SPI</th><th>Forecast Margin</th><th>Actions</th></tr></thead>
                            <tbody>
                                <tr><td>PRJ-1002</td><td>J. Miller</td><td>$1.8M</td><td>$1.1M</td><td>$1.05M</td><td>1.05</td><td>0.91</td><td class="text-success">33%</td><td><button class="btn btn-sm btn-outline-secondary" data-bs-toggle="offcanvas" data-bs-target="#scenarioPanel"><i class="bi bi-sliders"></i></button></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Offcanvas: Scenario Studio -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="scenarioPanel">
    <div class="offcanvas-header"><h5 class="offcanvas-title"><i class="bi bi-sliders me-2"></i>Scenario Studio</h5><button class="btn-close" data-bs-dismiss="offcanvas"></button></div>
    <div class="offcanvas-body">
        <div class="mb-3"><label class="form-label">Labor Cost ?</label><input type="range" class="form-range" min="-15" max="15" value="5"></div>
        <div class="mb-3"><label class="form-label">Material Cost ?</label><input type="range" class="form-range" min="-15" max="15" value="-3"></div>
        <div class="mb-3"><label class="form-label">Productivity ?</label><input type="range" class="form-range" min="-10" max="10" value="2"></div>
        <div class="chart-container"><canvas id="scenarioCompare"></canvas></div>
        <button class="btn btn-themed w-100 mt-3"><i class="bi bi-magic me-2"></i>Recalculate</button>
    </div>
</div>

<!-- Modal: AI Narrative -->
<div class="modal fade" id="aiNarrative" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content glass-effect border-0">
            <div class="modal-header"><h5 class="modal-title"><i class="bi bi-robot me-2"></i>AI Narrative</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">
                <p class="mb-2">Portfolio CPI is <strong>1.05</strong> (green) while SPI is <strong>0.92</strong> (slip). Materials cost pressure is the main risk (?3%).</p>
                <ul class="small text-themed-secondary mb-0"><li>Pull forward subcontractor package to recover schedule</li><li>Negotiate volume discounts on steel</li></ul>
            </div>
            <div class="modal-footer"><button class="btn btn-themed-secondary"><i class="bi bi-file-earmark-text me-1"></i>Add to Board Pack</button></div>
        </div>
    </div>
</div>
